Tools and environment: 
I used Apache Superset for this challenge, because i) that was the tool listed in the job advertisement and ii) that is what I currently have on my machine.  This is the first time I'm using it.  For Apache Superset, PostgreSQL is the database of choice.


Approach: 
The schema, sample data, and query structure were primarily generated by ChatGPT via prompting.  I checked each query to make sure it made sense for the problem at hand, and refined in some cases.


Assumptions made: 
1.  For queries from Part 2 (2.1 and 2.4), I assumed that the last 3 or 6 months meant the last full months, as calendar months seemed like a better assumption than using dates partway through months as limits.  This contrasts with the query for Part 2.5 which referenced the last 30 days.

2.  I assumed that for Part 2.4, when you said "show" the monthly trend that the SQL statement should also return a trendline in addition to the actual values of the missed appointments

3.  In Part 3.1a, total active patients was taken as the same definition previously used, i.e. those that had an appointment or message within the past 30 days

4.  For Part 3.1c, I used clinician workload over the last 60 days since the last 30 days didn't have enough data.

5.  Data generated appointments over the past year, but did not generate future appointments.


Query explanations (assume part #2 only):
2.1 (or Part 2a as used in filename):  COUNT(a.appointment_id) counts the number of appointments for this patient when taken over the joined table.  The WHERE clause ensures that these are completed appointments within the past 3 months.  LIMIT 5 will return up to 5 patients, but may return fewer if fewer than 5 patients have had appointments in the past 3 months.

2.2 (or Part 2b as used in filename): We use a sum over a case statement that counts missed appointments, then divide by the total number of appointments grouped by clinician.  

2.3 (or Part 2c as used in filename): We count the number of appointments, and divide by the count of distinct patients grouped by each separate clinician.  The ORDER BY and LIMIT guarantee that we get the top result in terms of average appointments per patient.

2.4 (or Part 2d as used in filename): This one is complex, so let me explain each SELECT statement separately.  The monthly_rates SELECT calculates the missed appointment percentage over each month in chronological order.  The numbered SELECT converts the months in the first SELECT statement to row numbers, and labels this as x.  The stats SELECT is an intermediate calculation that prepares us to calculate coefficients for the linear regression (e.g. the slope and intercept).  The slope and intercept are calculated in the coefficients SELECT.  The final SELECT calculates the trendline values using the slope and intercept, and prepares our data for plotting (this code segment is also used for a plot in Section 3 (second plot of section 3)).  

2.5 (or Part 2e as used in filename): We simply look for patients who have not had an appointment or sent a message within the last 30 days: in these cases, a.appointment_id and e.engagement_id are NULL in the joined table.

I also added the queries for Part 3 in this repo, but my interpretation of the assignment is that you only want explanations for the queries that were required to be uploaded for Part 2.


Limitations: 
1.  To be fair to all clinicians, the average number of appointments per patient should probably be queried with additional factors in mind, like how many patients they have, how long they've been seeing patients, how many patients have discontinued, etc.
2.  There are some aspects of working in Apache Superset that I haven't mastered yet, as this was my first time using it.  Given more time, I'd investigate whether it's possible to i) increase the size of labels such as axis titles and ticks ii) Edit the legends, in particular so that they don't contain the word MAX() around the metrics iii) I would have liked the trendline to be dashed and more visible.
